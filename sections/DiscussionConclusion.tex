\chapter{Discussion and conclusion}
\section{Discussion}
Before answering the research question stated in the introduction, a few interesting observations are made.

It can be seen from the lag comparison subplot in Figure~\ref{fig:result_all_lagerrorscaling} that only signal processing chains that use whitening appear to introduce lag. This could be caused by the phase delay that is introduced by the whitening filter. If the filter were to have a linear phase then all frequencies would be equally delayed resulting in a constant group delay. If this filter did not have linear phase but instead introduces a stronger phase delay in higher frequencies, then the total delay would become more apparent when amplifying these higher frequencies \cite{phase_delay_frequencies}. The amplification of higher frequencies does happen in the whitening filter as can be seen in the simulation in \ref{fig:whitening_simulation}, and the time domain plot shows signs of introduction of delay in the filtered signal which can stem from making higher frequencies with more phase delay more prominent. In the simulations the phase of the whitening filter was set to the phase of the input signal ('source' of filter). In the appendix are the results of constructing the whitening filter using zero-phase, linear-phase, and negative input signal phase \ref{fig:result_whitening_linearphase} \ref{fig:result_whitening_negative_sourcephase}\ref{fig:result_whitening_sourcephase}\ref{fig:result_whitening_zerophase}. Intuitively it would be expected that using negative source phase would counteract this introduced delay, but as can be seen in appendix Figure~\ref{fig:result_whitening_negative_sourcephase} this does not appear to be the case. 

A perhaps much more intriguing result stemming from the lag subplot in Figure~\ref{fig:result_all_lagerrorscaling} is the introduction of \textit{negative lag} in some processing combinations. This indicates that some processing methods allow \textit{predicting} when and how much force will be applied. Even though that may seem impossible at first it can actually be explained very intuitively. sEMG measures the activation of a muscle, the activation of a muscle leads to muscle contraction, and muscle contraction results in a force being applied to the arm. Since the arm has weight, this force first results in acceleration before it is transferred to the handle connected to the load cell. As a result the sEMG signal is measured slightly before the actual force is measured by the load cell. This is in line with literature \cite{human_robotics}. Using some processing chains the force can be predicted around 500ms before it is applied to and measured by the load cell! In terms of lag it can also be noticed that using zero phase for the whitening filter seems to reduce a large portion of the lag as can be seen in appendix Figure~\ref{fig:result_whitening_zerophase}.

One processing step that stands out in the lag plot of Figure~\ref{fig:result_all_lagerrorscaling} is adaptive filtering. It can be seen that applying an adaptive LMS filter results in unusually fast response time (negative lag). Adaptive filtering does seem to introduce more error as seen in the error subplot, but this is marginal compared to other filtering methods.

Lastly it seems that the IIR Butterworth lowpass filter for envelope detection introduces a significant amount of lag compared to moving average or RMS envelope detection. This is consistent across all filters and whitening as can be seen in the lag subplot in Figure~\ref{fig:result_all_lagerrorscaling}. This is also consistent with simulations as seen in figures \ref{fig:lagerror_RMS_MA} and \ref{fig:lagerror_iir} given the filter length and cutoff frequency that were used in the measurements. 

\section{Research question}
The research question presented in the introduction states the goal of finding the best combination of whitening, filtering, and envelope detection to estimate force from sEMG. 

The answer to this question depends on the application. If lag is the sole/primary concern then the processing chain of no whitening, adaptive LMS filter, and RMS envelope detection is the ideal solution as it results in the most negative lag, closely followed by moving average envelope detection. If error is the primary concern then no whitening, no filtering, and RMS envelope detection is the optimal solution. 

The fact that the lowest error rates are achieved in processing chains that include no filtering hints at the fact that improving the signal to noise ratio of an sEMG signal does not result in a better estimation of the applied force. It should be noted that this conclusion is drawn from a single measurement at a single location and thus may yield different results in different environments. 

\section{Conclusion}
In this report a complete signal processing chain for sEMG signals was presented. Within each step in this processing chain various processing techniques were discussed and tested to illustrate their behaviour and performance when applied to sEMG signals.

In a simulated environment it was shown that static filter performance does not depend on MVC, and that a Wiener filter provides the highest SNR after filtering (Figure~\ref{fig:filter_snr_mvc}) but this came at the cost of the worst bandwidth of all filtering techniques (Figure~\ref{fig:filter_bw_mvc}).

Applying filtering in a practical situation to accurately estimate force from sEMG shows that high SNR but low bandwidth does not relate to high accuracy. As a result, not applying any filtering on the sEMG signal provided the best results in terms of error. Adaptive LMS filtering \textit{did} perform the best in terms of lag in some scenarios preceding the measured force signal by 500ms!

The conclusion drawn from comparing different envelope estimation techniques is that infinite impulse response Butterworth lowpass filter introduces significantly more lag than moving average and RMS filtering, both of which performed approximately the same with moving average yielding a slightly better in terms of lag.

Lastly, whitening introduced significant lag across all filters and envelope detection methods.

\section{Recommendations}
One area where the results presented in this report can be improved is by using a larger data set to apply the processing techniques to. Since the techniques were only validated using a single long measurement it is very well possible that the techniques function differently in different environments or with different hardware.

Concerning the implementation of filters, it might be interesting to develop and test a more elaborate algorithm that can for example change the window size of the adaptive filter based on the amplitude of the signal. This could reduce the required processing power to implement certain processing chains. Additionally the notable results from adaptive LMS filtering in terms of lag suggests more research into optimization of this filter. Since only a single combination of filter length and convergence coefficient was used (drawn from simulated data), it might be useful to determine a wider range of variables on sEMG data sets.

This report also assumed a linear relation between the sEMG and the estimated force. Future research could possible explore different relations and the influence of different signal processing chains.

Lastly, this report has given insight into the performance of different processing techniques but has omitted the computational complexity that is required to apply them in real-time such as robotic prostheses \cite{semg_application_prosthesis} which have limited processing power. 